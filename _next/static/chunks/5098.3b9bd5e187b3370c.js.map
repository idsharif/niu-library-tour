{"version":3,"file":"static/chunks/5098.3b9bd5e187b3370c.js","mappings":"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","sources":["webpack://_N_E/./components/SvgContainer/styled.ts","webpack://_N_E/./containers/Home/components/Collaboration/CommentScene/styled.ts","webpack://_N_E/./containers/Home/hook/useCommentScene.tsx","webpack://_N_E/<anon>"],"sourcesContent":["/**\n *\n * styled SvgContainer\n *\n */\nimport styled from 'styled-components';\n\nexport const SvgContainerWrapper = styled.div`\n  width: 100%;\n  height: 100%;\n  svg {\n    width: 100%;\n    height: 100%;\n  }\n`;\n","import { SvgContainerWrapper } from '@components/SvgContainer/styled';\nimport { FlexRowBetween, FlexRowCenter } from '@styles/global-styles';\nimport styled from 'styled-components';\n\nexport const CommentSceneIconWrapper = styled.div`\n  width: 42px;\n  height: auto;\n  display: inline-flex;\n  position: relative;\n  &.resolved {\n    transform: scale(0.85);\n    opacity: 0.75;\n  }\n  ${SvgContainerWrapper} {\n    height: auto;\n    path {\n      fill: rgb(250 173 20 / 80%);\n      stroke: #fff;\n      stroke-width: 2;\n    }\n  }\n  .--icon {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    display: inline-flex;\n    align-items: center;\n    color: #fff;\n    font-weight: 600;\n  }\n  &.resolved {\n    .--icon {\n      i {\n        font-size: 18px;\n      }\n    }\n    svg {\n      path {\n        fill: rgba(46, 194, 106, 0.8);\n        stroke: #fff;\n        stroke-width: 2;\n      }\n    }\n  }\n`;\n\nexport const CommentSceneItemWrapper = styled.div`\n  width: 100%;\n  color: #ffffff;\n  display: flex;\n  .--main {\n    width: 100%;\n  }\n\n  .countComment {\n    width: max-content;\n    padding: 4px 6px;\n    background: var(--color-dark-2);\n    display: flex;\n    border-radius: 4px;\n    cursor: pointer;\n    align-items: center;\n    i {\n      margin-right: 8px;\n    }\n    span {\n      opacity: 0.5;\n    }\n    &:hover {\n      span {\n        opacity: 1;\n      }\n    }\n  }\n\n  &.parent-layout {\n    .--main {\n      .user {\n        display: flex;\n        .avt {\n          margin-right: 8px;\n          flex: 0 0 auto;\n          img {\n            width: 42px;\n            height: 42px;\n            object-fit: cover;\n            border-radius: 50%;\n            background: #ffffff;\n          }\n        }\n        .info {\n          .name {\n            font-weight: 600;\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            max-width: 150px;\n          }\n          .time {\n            color: var(--color-smoke);\n            font-size: 12px;\n          }\n        }\n      }\n      .txt {\n        margin: 8px 0;\n      }\n    }\n  }\n  &.children-layout {\n    .--main {\n      display: flex;\n      align-items: flex-start;\n      .avt {\n        margin-right: 12px;\n        border-radius: 50%;\n        overflow: hidden;\n        background: #ffffff;\n        flex: 0 0 auto;\n        img {\n          width: 42px;\n          height: 42px;\n          object-fit: cover;\n        }\n      }\n      .content {\n        background: rgba(0, 0, 0, 0.5);\n        border-radius: 8px;\n        padding: 8px 12px;\n        width: 100%;\n        .info {\n          display: flex;\n          align-items: flex-end;\n          .name {\n            font-weight: 600;\n            font-size: 15px;\n          }\n          .time {\n            color: #969fa7;\n            font-size: 12px;\n            margin-left: 8px;\n          }\n        }\n        .txt {\n          margin: 6px 0 3px;\n        }\n      }\n    }\n    &:not(:last-child) {\n      margin-bottom: 12px;\n    }\n    &:last-child {\n      margin-bottom: 8px;\n    }\n  }\n  .--extra {\n    flex: 0 0 auto;\n    margin-left: 8px;\n    i {\n      cursor: pointer;\n      &:after {\n        position: absolute;\n        content: '';\n        width: 24px;\n        height: 24px;\n        left: 50%;\n        top: 50%;\n        transform: translate(-50%, -50%);\n        z-index: 2;\n      }\n    }\n  }\n`;\n\nexport const CommentBoxWrapper = styled.div`\n  margin: 8px 0;\n  textarea {\n    width: 100%;\n    border: 1px solid rgba(255, 255, 255, 0.25);\n    outline: none !important;\n    box-shadow: none !important;\n    padding: 0.25rem 0.5rem;\n    width: 100%;\n    color: #fff;\n    // font-size: 14px;\n    // font-weight: 400;\n    background-color: var(--color-dark);\n    resize: none;\n    border-radius: 4px;\n    color: inherit;\n    max-height: 250px !important;\n    user-select: all;\n    &::placeholder {\n      opacity: 0.5;\n      color: rgba(255, 255, 255, 0.57);\n      font-size: 14px;\n    }\n    &:hover {\n      border-color: rgb(255 255 255 / 0.5);\n    }\n    &:focus {\n      border-color: #ffffff50;\n      background-color: rgb(0 0 0 / 0.5);\n    }\n    &:active {\n    }\n    &[disabled] {\n      background-color: rgba(0, 0, 0, 0.25);\n      color: rgba(255, 255, 255, 0.75);\n    }\n  }\n  .--bottom {\n    ${FlexRowBetween};\n    color: #fff;\n    .act {\n      &-extra {\n        i {\n          cursor: pointer;\n        }\n      }\n      &-main {\n        .--btn {\n          border: none;\n          height: auto;\n          padding: 4px 12px;\n          border-radius: 4px;\n          span {\n            margin-left: 4px;\n          }\n          &.--submit {\n            margin-right: 8px;\n            background-color: var(--color-theme);\n            color: #fff;\n          }\n          &.--cancel {\n            background-color: var(--color-dark-2);\n            color: var(--color-smoke);\n          }\n        }\n      }\n    }\n  }\n`;\n\nexport const CommentScenePopoverWrapper = styled.div`\n  width: 400px;\n  padding: 16px 16px 0;\n  background: rgb(33 33 33 / 80%);\n  position: relative;\n  border-radius: 12px;\n  border: 1px solid rgba(255, 255, 255, 0.75);\n  .--parent {\n    ${CommentSceneItemWrapper} {\n      .--action {\n        margin-top: 8px;\n        .ant-btn {\n          background: rgb(47 208 172 / 20%);\n          border-radius: 6px;\n          height: auto;\n          color: var(--color-green);\n          border: 1px solid var(--color-green);\n          padding: 4px 8px;\n          span {\n            margin-left: 8px;\n          }\n          &[disabled] {\n            background: var(--color-green);\n            color: #fff;\n          }\n        }\n      }\n      padding-bottom: 12px;\n      border-bottom: 1px solid rgba(255, 255, 255, 0.25);\n    }\n  }\n  .--children {\n    margin-top: 12px;\n    max-height: 350px;\n    overflow: auto;\n  }\n  .--add-new {\n    border-top: 1px solid rgba(255, 255, 255, 0.4);\n    border-radius: 0 0 12px 12px;\n    margin-left: -16px;\n    width: calc(100% + 32px);\n    padding: 12px 16px;\n    background: var(--color-dark);\n    color: #fff;\n    ${CommentBoxWrapper} {\n      margin: 0;\n    }\n  }\n  .--close {\n    position: absolute;\n    right: -10px;\n    top: -10px;\n    width: 24px;\n    height: 24px;\n    background: #fff;\n    color: #333;\n    border-radius: 50%;\n    ${FlexRowCenter};\n    cursor: pointer;\n    i {\n    }\n  }\n`;\n\nexport const DialogCreateCommentSceneWrapper = styled.div`\n  padding: 16px;\n  background: var(--color-dark);\n  border-radius: 16px;\n  border: 1px solid rgba(255, 255, 255, 0.25);\n  .--icon-close {\n    position: absolute;\n    background: transparent;\n    color: #fff;\n    right: 6px;\n    top: 10px;\n    box-shadow: none;\n  }\n  .header {\n    ${FlexRowBetween}\n    .title {\n      color: #fff;\n      font-weight: 600;\n    }\n  }\n  .popover {\n    margin: 16px 0 0;\n    position: relative;\n    ${CommentBoxWrapper} {\n      margin-bottom: 0;\n      color: #fff;\n    }\n  }\n`;\n","/* eslint-disable prefer-destructuring */\nimport { Type_RefFuncKrpano } from '@components/Krpano/types';\nimport { RequireSomeField } from '@type/customType';\nimport { BaseXHR } from '@utils/axios';\nimport { useCallback, useEffect, useMemo, useRef } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useCollaborationMode } from '../global/TourStats';\nimport {\n  selectToken,\n  selectInfoUser,\n  selectIsOwnerTour,\n  selectListCommentSceneSelected,\n  selectIsAllowToAccessOnCollaborationMode,\n} from '../selectors';\nimport { actions } from '../slice';\nimport { I_CommentScene, I_PayloadCommentScene } from '../types';\n\nexport const useCommentScene = () => {\n  const dispatch = useDispatch();\n  const token = useSelector(selectToken);\n  const listCommentSceneSelected = useSelector(selectListCommentSceneSelected);\n  const infoUser = useSelector(selectInfoUser);\n  const isOwnerTour = useSelector(selectIsOwnerTour);\n  const isAllowToAccessOnCollaborationMode = useSelector(\n    selectIsAllowToAccessOnCollaborationMode,\n  );\n\n  const listCommentSceneGroupByParentRef = useRef<I_CommentScene[]>([]);\n\n  const [krpanoInstance] = useCollaborationMode('krpanoRef');\n  const [, setCommentSceneSelected] = useCollaborationMode(\n    'commentSceneSelected',\n  );\n  const [, setIsShowDialogCreateCommentScene] = useCollaborationMode(\n    'isShowDialogCreateCommentScene',\n  );\n  const [, setLoading] = useCollaborationMode('loading');\n\n  const listCommentSceneGroupByParent = useMemo(\n    () =>\n      listCommentSceneSelected\n        ?.filter(item => !item.parent)\n        ?.slice()\n        ?.sort((a, b) => a.created_at.localeCompare(b.created_at))\n        ?.map((item, index) => ({\n          ...item,\n          index: index + 1,\n          isOwnerTour,\n          isOwnerComment: item.user?.id === infoUser?.id,\n          children:\n            listCommentSceneSelected\n              ?.filter(el => el.parent === item.id)\n              ?.map(el => ({\n                ...el,\n                isOwnerTour,\n                isOwnerComment: el.user?.id === infoUser?.id,\n              }))\n              ?.slice()\n              ?.sort((a, b) => b.created_at.localeCompare(a.created_at)) || [],\n        })) || [],\n    [infoUser?.id, isOwnerTour, listCommentSceneSelected],\n  );\n\n  const listCommentSceneGroupByParentResolved = useMemo(\n    () => listCommentSceneGroupByParent.filter(item => !!item.isResolved),\n    [listCommentSceneGroupByParent],\n  );\n\n  const listCommentSceneGroupByParentActive = useMemo(\n    () => listCommentSceneGroupByParent.filter(item => !item.isResolved),\n    [listCommentSceneGroupByParent],\n  );\n\n  useEffect(() => {\n    listCommentSceneGroupByParentRef.current = listCommentSceneGroupByParent;\n  }, [listCommentSceneGroupByParent]);\n\n  const onRequestAccessCollaboration = useCallback(\n    async (project_id: string) => {\n      setLoading(true);\n      try {\n        const { data } = await BaseXHR.$post(\n          '/comment-scene/send-request-access-collab',\n          { project_id },\n          {\n            headers: {\n              Authorization: `Bearer ${token}`,\n            },\n          },\n        );\n        return data;\n      } finally {\n        setLoading(false);\n      }\n    },\n    [token, setLoading],\n  );\n\n  const onCreateCommentScene = useCallback(\n    async (\n      payload: Omit<I_PayloadCommentScene, 'id' | 'children'>,\n      instanceKrpano: Type_RefFuncKrpano = krpanoInstance,\n    ) => {\n      setLoading(true);\n      try {\n        const { data } = await BaseXHR.$post('/comment-scene/create', payload, {\n          headers: {\n            Authorization: `Bearer ${token}`,\n          },\n        });\n        dispatch(actions.createCommentScene(data.data));\n\n        let newData;\n        if (data.data.parent) {\n          const commentSelected =\n            listCommentSceneGroupByParentRef.current.filter(\n              item => item.id === data.data.parent,\n            )[0];\n          newData = {\n            ...commentSelected,\n            children: [\n              { ...data.data, isOwnerTour, isOwnerComment: true },\n              ...(commentSelected.children || []),\n            ],\n          };\n          if (instanceKrpano) instanceKrpano.onReplaceCommentScene(newData);\n        } else {\n          newData = {\n            ...data.data,\n            isOwnerTour,\n            isOwnerComment: true,\n            index: listCommentSceneGroupByParentRef.current.length + 1,\n          };\n          newData.children = [];\n          if (instanceKrpano) instanceKrpano.onAddCommentScene(newData);\n        }\n        setIsShowDialogCreateCommentScene(false);\n      } finally {\n        setLoading(false);\n      }\n    },\n    [\n      token,\n      dispatch,\n      setLoading,\n      isOwnerTour,\n      krpanoInstance,\n      setIsShowDialogCreateCommentScene,\n    ],\n  );\n\n  const onUpdateCommentScene = useCallback(\n    async (\n      payload: RequireSomeField<I_PayloadCommentScene, 'id'>,\n      instanceKrpano: Type_RefFuncKrpano = krpanoInstance,\n    ) => {\n      setLoading(true);\n      try {\n        const { data } = await BaseXHR.$put('/comment-scene/update', payload, {\n          headers: {\n            Authorization: `Bearer ${token}`,\n          },\n        });\n        dispatch(actions.updateCommentScene(data.data));\n\n        let newData;\n        if (data.data.parent) {\n          const commentSelected =\n            listCommentSceneGroupByParentRef.current.filter(\n              item => item.id === data.data.parent,\n            )[0];\n          newData = commentSelected;\n          newData.children = newData.children.map(item =>\n            item.id === data.data.id\n              ? {\n                  ...data.data,\n                  children: [],\n                  isOwnerTour,\n                  isOwnerComment: true,\n                }\n              : item,\n          );\n        } else {\n          const commentSelected =\n            listCommentSceneGroupByParentRef.current.filter(\n              item => item.id === data.data.id,\n            )[0];\n          newData = {\n            ...commentSelected,\n            ...data.data,\n            isOwnerTour,\n            isOwnerComment: true,\n          };\n        }\n        if (instanceKrpano) instanceKrpano.onReplaceCommentScene(newData);\n      } finally {\n        setLoading(false);\n      }\n    },\n    [krpanoInstance, setLoading, token, dispatch, isOwnerTour],\n  );\n\n  const onDeleteCommentScene = useCallback(\n    async (\n      payload: I_CommentScene,\n      instanceKrpano: Type_RefFuncKrpano = krpanoInstance,\n      isClosePopoverOnKrpano: boolean = false,\n    ) => {\n      setLoading(true);\n      try {\n        await BaseXHR.$delete(\n          '/comment-scene/delete',\n          { id: payload.id },\n          {\n            headers: {\n              Authorization: `Bearer ${token}`,\n            },\n          },\n        );\n        dispatch(actions.deleteCommentScene(payload));\n\n        let newData;\n        if (payload.parent) {\n          const commentSelected =\n            listCommentSceneGroupByParentRef.current.filter(\n              item => item.id === payload.parent,\n            )[0];\n          newData = commentSelected;\n          newData.children = newData.children.filter(\n            item => item.id !== payload.id,\n          );\n          if (instanceKrpano) instanceKrpano.onReplaceCommentScene(newData);\n        } else if (instanceKrpano)\n          instanceKrpano.onRemoveCommentScene(payload.id);\n\n        if (isClosePopoverOnKrpano) setCommentSceneSelected(null);\n      } finally {\n        setLoading(false);\n      }\n    },\n    [token, dispatch, setLoading, krpanoInstance, setCommentSceneSelected],\n  );\n\n  return useMemo(\n    () => ({\n      isOwnerTour,\n      onCreateCommentScene,\n      onUpdateCommentScene,\n      onDeleteCommentScene,\n      listCommentSceneGroupByParent,\n      onRequestAccessCollaboration,\n      isAllowToAccessOnCollaborationMode,\n      listCommentSceneGroupByParentActive,\n      listCommentSceneGroupByParentResolved,\n    }),\n    [\n      isOwnerTour,\n      onCreateCommentScene,\n      onUpdateCommentScene,\n      onDeleteCommentScene,\n      onRequestAccessCollaboration,\n      listCommentSceneGroupByParent,\n      isAllowToAccessOnCollaborationMode,\n      listCommentSceneGroupByParentActive,\n      listCommentSceneGroupByParentResolved,\n    ],\n  );\n};\n"],"names":["SvgContainerWrapper","styled","CommentSceneIconWrapper","CommentSceneItemWrapper","CommentBoxWrapper","FlexRowBetween","CommentScenePopoverWrapper","FlexRowCenter","DialogCreateCommentSceneWrapper","useCommentScene","dispatch","useDispatch","token","useSelector","selectToken","listCommentSceneSelected","selectListCommentSceneSelected","infoUser","selectInfoUser","isOwnerTour","selectIsOwnerTour","isAllowToAccessOnCollaborationMode","selectIsAllowToAccessOnCollaborationMode","listCommentSceneGroupByParentRef","useRef","krpanoInstance","useCollaborationMode","setCommentSceneSelected","setIsShowDialogCreateCommentScene","setLoading","listCommentSceneGroupByParent","useMemo","slice","filter","item","parent","sort","a","b","created_at","localeCompare","map","index","_swc_helpers_src_object_spread_props_mjs__WEBPACK_IMPORTED_MODULE_7__","Z","_swc_helpers_src_object_spread_mjs__WEBPACK_IMPORTED_MODULE_8__","isOwnerComment","user","id","children","el","listCommentSceneGroupByParentResolved","isResolved","listCommentSceneGroupByParentActive","useEffect","current","onRequestAccessCollaboration","useCallback","_swc_helpers_src_async_to_generator_mjs__WEBPACK_IMPORTED_MODULE_9__","project_id","BaseXHR","headers","Authorization","concat","_state","sent","data","onCreateCommentScene","payload","instanceKrpano","newData","commentSelected","actions","_swc_helpers_src_to_consumable_array_mjs__WEBPACK_IMPORTED_MODULE_11__","onReplaceCommentScene","length","onAddCommentScene","onUpdateCommentScene","onDeleteCommentScene","isClosePopoverOnKrpano","onRemoveCommentScene"],"sourceRoot":""}